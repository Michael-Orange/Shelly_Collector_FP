EATURE : Fallback automatique de pÃ©riode si pas de donnÃ©es

OBJECTIF : Ã‰viter d'afficher un graphique vide au premier chargement.

COMPORTEMENT :
1. Chargement initial â†’ tenter pÃ©riode 24h
2. Si aucune donnÃ©e â†’ fallback automatique Ã  7 jours + message d'info
3. Si toujours aucune donnÃ©e â†’ afficher message "Aucune donnÃ©e sur 7 jours" + bouton manuel "Essayer 30 jours"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

IMPLÃ‰MENTATION

FRONTEND : Modifier loadChartData()

```javascript
async function loadChartData(periodOverride = null) {
    const deviceSelect = document.getElementById('deviceFilter');
    const channelSelect = document.getElementById('channelFilter');
    const endDateInput = document.getElementById('chartEndDate');
    
    const selectedDevice = deviceSelect?.value;
    const selectedChannel = channelSelect?.value;
    const endDate = endDateInput?.value;
    
    // Masquer si pas de device
    const chartSection = document.getElementById('chart-section');
    if (!selectedDevice || selectedDevice === 'all') {
        chartSection.style.display = 'none';
        return;
    }
    
    chartSection.style.display = 'block';
    
    // Utiliser pÃ©riode forcÃ©e ou pÃ©riode actuelle
    const period = periodOverride || currentPeriod;
    
    // Construire URL API
    let url = `/api/power-chart-data?device_id=${encodeURIComponent(selectedDevice)}&period=${period}`;
    
    if (selectedChannel && selectedChannel !== 'all') {
        url += `&channel=${encodeURIComponent(selectedChannel)}`;
    }
    
    const today = new Date().toISOString().split('T')[0];
    if (endDate && endDate !== today) {
        url += `&end_date=${endDate}`;
    }
    
    try {
        const response = await fetch(url);
        const result = await response.json();
        
        // VÃ‰RIFIER SI DONNÃ‰ES VIDES
        const hasData = Object.values(result.data || {}).some(channelData => 
            channelData.timestamps && channelData.timestamps.length > 0
        );
        
        if (!hasData && !periodOverride) {
            // PAS DE DONNÃ‰ES sur la pÃ©riode par dÃ©faut
            
            if (currentPeriod === '24h') {
                // Fallback automatique vers 7 jours
                console.log('âš ï¸ Aucune donnÃ©e sur 24h, fallback vers 7 jours');
                showInfoMessage('â„¹ï¸ Aucune donnÃ©e sur les derniÃ¨res 24h. Affichage Ã©tendu Ã  7 jours.');
                
                // Changer visuellement le bouton actif
                document.querySelectorAll('.period-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelector('[data-period="7d"]').classList.add('active');
                currentPeriod = '7d';
                
                // Recharger avec 7 jours
                return await loadChartData('7d');
            }
            
            if (currentPeriod === '7d' && !periodOverride) {
                // Pas de fallback automatique vers 30j, proposer manuellement
                console.log('âš ï¸ Aucune donnÃ©e sur 7 jours');
                showInfoMessage('â„¹ï¸ Aucune donnÃ©e sur les 7 derniers jours.', true);
                // Afficher le graphique vide avec message
            }
        }
        
        // Masquer le message d'info si donnÃ©es prÃ©sentes
        hideInfoMessage();
        
        // Mettre Ã  jour le graphique
        updateChartTitle();
        updateChart(result.data);
        
    } catch (e) {
        console.error('âŒ Erreur chargement graphique:', e);
        showInfoMessage('âŒ Erreur de chargement des donnÃ©es', false);
    }
}
AJOUTER fonctions pour messages d'info :
function showInfoMessage(message, showTry30Button = false) {
    let infoDiv = document.getElementById('chart-info-message');
    
    if (!infoDiv) {
        infoDiv = document.createElement('div');
        infoDiv.id = 'chart-info-message';
        infoDiv.className = 'chart-info-banner';
        
        // InsÃ©rer avant le canvas du graphique
        const chartContainer = document.querySelector('.chart-container');
        chartContainer.parentElement.insertBefore(infoDiv, chartContainer);
    }
    
    infoDiv.innerHTML = `
        <span>${message}</span>
        ${showTry30Button ? '<button onclick="tryPeriod30Days()" class="btn-try-30">Essayer 30 jours</button>' : ''}
    `;
    infoDiv.style.display = 'block';
}

function hideInfoMessage() {
    const infoDiv = document.getElementById('chart-info-message');
    if (infoDiv) {
        infoDiv.style.display = 'none';
    }
}

async function tryPeriod30Days() {
    document.querySelectorAll('.period-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelector('[data-period="30d"]').classList.add('active');
    currentPeriod = '30d';
    await loadChartData();
}
CSS pour le bandeau d'info :
.chart-info-banner {
    background: #e7f3ff;
    border: 1px solid #b3d9ff;
    border-radius: 6px;
    padding: 12px 16px;
    margin-bottom: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.9em;
    color: #004085;
}

.chart-info-banner span {
    flex: 1;
}

.btn-try-30 {
    padding: 6px 12px;
    background: #2d5a3d;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.9em;
    margin-left: 15px;
}

.btn-try-30:hover {
    background: #234a30;
}
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
COMPORTEMENTS ATTENDUS
CHARGEMENT AVEC DONNÃ‰ES SUR 24H :
Vue 24h chargÃ©e
Graphique affichÃ©
Pas de message
CHARGEMENT SANS DONNÃ‰ES SUR 24H, AVEC DONNÃ‰ES SUR 7J :
Tentative 24h â†’ vide
Fallback automatique vers 7j
Message : "â„¹ï¸ Aucune donnÃ©e sur les derniÃ¨res 24h. Affichage Ã©tendu Ã  7 jours."
Bouton "7 jours" devient actif visuellement
Graphique 7j affichÃ©
CHARGEMENT SANS DONNÃ‰ES SUR 24H NI 7J :
Tentative 24h â†’ vide â†’ fallback 7j â†’ vide
Message : "â„¹ï¸ Aucune donnÃ©e sur les 7 derniers jours." + bouton "Essayer 30 jours"
Graphique vide avec axes
Clic sur bouton â†’ charge 30j manuellement
CHANGEMENT MANUEL DE PÃ‰RIODE :
User clique sur "30 jours" â†’ pas de fallback, charge directement 30j
Si vide â†’ affiche graphique vide (pas de fallback supplÃ©mentaire)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
TESTS Ã€ EFFECTUER
Device avec mesures rÃ©centes â†’ vue 24h par dÃ©faut, graphique affichÃ©
Device sans mesures depuis 2 jours â†’ fallback automatique 7j + message
Device sans mesures depuis 10 jours â†’ message + bouton "Essayer 30j"
Clic manuel sur pÃ©riode â†’ pas de fallback automatique
Changement de device â†’ rÃ©initialiser pÃ©riode Ã  24h et retenter fallback
ImplÃ©mente et teste ces scÃ©narios.

---

## âœ… MA VALIDATION FINALE

**OUI je valide** cette feature avec l'implÃ©mentation proposÃ©e car :
1. âœ… LimitÃ©e Ã  2 tentatives max (pas 3)
2. âœ… Message d'info clair pour l'utilisateur
3. âœ… Bouton manuel pour 30j (pas automatique)
4. âœ… Pas de complexitÃ© backend (logique frontend simple)
5. âœ… RÃ©versible : user peut revenir Ã  24h manuellement

**CONDITION :** Si tu constates que Ã§a fait trop de requÃªtes en prod, on passe Ã  l'approche "requÃªte unique backend" qui retourne la date de derniÃ¨re mesure.

Go pour cette implÃ©mentation ! ğŸš€
REFONTE : SÃ©paration des graphiques Puissance et Courant avec systÃ¨me d'onglets

PROBLÃˆME ACTUEL :
Les deux axes Y (Puissance W + Courant A) sur le mÃªme graphique rendent la lecture difficile. Les courbes lissÃ©es n'ont pas de sens pour des mesures Ã©lectriques discrÃ¨tes.

NOUVELLE APPROCHE :
- 2 graphiques sÃ©parÃ©s (Puissance et Courant)
- SystÃ¨me d'onglets pour basculer entre les deux
- ContrÃ´les temporels (24h/7j/30j + date) partagÃ©s entre les deux
- Lignes droites (step) au lieu de courbes lissÃ©es
- Masquage complet de la section si aucun device sÃ©lectionnÃ©

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

INTERFACE UTILISATEUR

1. STRUCTURE DE LA SECTION GRAPHIQUE

Quand un device est sÃ©lectionnÃ©, afficher :

[ContrÃ´les temporels - partagÃ©s]
- Date picker "Jusqu'au"
- Boutons 24h / 7 jours / 30 jours
- Bouton export PNG

[Onglets de sÃ©lection de graphique]
- âš¡ Consommation Ã©lectrique (W)
- ğŸ”Œ Courant (A)

[Zone de graphique]
- Un seul canvas Chart.js
- Contenu change selon l'onglet actif

2. COMPORTEMENT DES ONGLETS

- Par dÃ©faut : onglet "Consommation Ã©lectrique" actif
- Clic sur un onglet â†’ recharge le graphique correspondant
- Style visuel : onglet actif = fond vert Filtreplante, onglet inactif = fond blanc

3. MASQUAGE COMPLET SI PAS DE DEVICE

Conditions pour afficher la section complÃ¨te :
- Device sÃ©lectionnÃ©
- Device â‰  "all" (pas "Tous les devices")

Si condition non remplie :
- Masquer TOUTE la section (contrÃ´les + onglets + graphique)
- Ne pas afficher de bloc vide
- Utiliser display: none

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

GRAPHIQUES

1. GRAPHIQUE PUISSANCE (W)

- Type : line avec stepped: true (lignes droites, pas de courbes)
- Axe Y : Puissance (W)
- Une courbe par canal (si plusieurs canaux, sinon une seule)
- Couleurs : palette verte Filtreplante (dÃ©jÃ  dÃ©finie)
- Ã‰chelle Y : automatique avec grace 10%

2. GRAPHIQUE COURANT (A)

- Type : line avec stepped: true
- Axe Y : IntensitÃ© (A)
- Une courbe par canal
- MÃªmes couleurs que graphique puissance (cohÃ©rence visuelle)
- Ã‰chelle Y : automatique avec grace 10%

3. CONFIGURATION CHART.JS

Options importantes Ã  modifier :
- tension: 0 (au lieu de 0.4) â†’ pas de lissage
- stepped: true â†’ lignes en escalier
- spanGaps: false â†’ trous dans les donnÃ©es visibles
- Un seul axe Y par graphique (plus de y1)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

LOGIQUE BACKEND

API reste identique :
- /api/power-chart-data retourne toujours power_w ET current_a
- Le frontend choisit quelles donnÃ©es afficher selon l'onglet actif

Pas de modification cÃ´tÃ© serveur nÃ©cessaire.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

LOGIQUE FRONTEND

1. VARIABLE D'Ã‰TAT

Ajouter une variable globale :
- currentChartType = 'power' ou 'current'
- Par dÃ©faut : 'power'

2. FONCTION switchChartType(type)

- Mettre Ã  jour currentChartType
- Mettre Ã  jour les styles des onglets (actif/inactif)
- Recharger le graphique avec updateChart()

3. FONCTION updateChart() MODIFIÃ‰E

Selon currentChartType :
- Si 'power' : crÃ©er datasets avec data.power_w, yAxisID='y', label="Canal X - Puissance"
- Si 'current' : crÃ©er datasets avec data.current_a, yAxisID='y', label="Canal X - IntensitÃ©"

Configuration Chart.js adaptÃ©e :
- Un seul axe Y (plus de y1)
- Titre axe Y selon le type : "Puissance (W)" ou "IntensitÃ© (A)"
- stepped: true dans les options

4. FONCTION loadChartData() MODIFIÃ‰E

Conditions d'affichage :
if (!selectedDevice || selectedDevice === 'all') {
// Masquer TOUTE la section chart-section
chartSection.style.display = 'none';
return;
}
// Afficher la section
chartSection.style.display = 'block';
// Charger les donnÃ©es et mettre Ã  jour le graphique

5. EXPORT PNG

Le nom du fichier doit inclure le type de graphique :
- filtreplante_{device}_{type}_{period}_{date}.png
- Exemple : filtreplante_shellypro_power_7d_2026-02-19.png

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

STYLE VISUEL

1. ONGLETS

Structure HTML suggÃ©rÃ©e :
<div class="chart-tabs"> <button class="chart-tab active" data-type="power"> âš¡ Consommation Ã©lectrique (W) </button> <button class="chart-tab" data-type="current"> ğŸ”Œ Courant (A) </button> </div> ```
CSS :
Onglet actif : background #2d5a3d (vert Filtreplante), color white
Onglet inactif : background white, color #2d5a3d, border 2px solid #2d5a3d
Hover sur inactif : background #f0f7f3
Transition smooth
Responsive : sur mobile, onglets prennent toute la largeur
PLACEMENT
Ordre des Ã©lÃ©ments dans chart-section :
Titre (avec plage de dates)
ContrÃ´les temporels (date + pÃ©riode + export)
Onglets de graphique
Canvas du graphique
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
COMPORTEMENTS ATTENDUS
CHARGEMENT INITIAL (device sÃ©lectionnÃ©)
Section graphique visible
Onglet "Consommation Ã©lectrique" actif
Graphique Puissance affichÃ© (lignes droites)
ContrÃ´les temporels : date=aujourd'hui, pÃ©riode=24h
CLIC SUR ONGLET "Courant"
Onglet "Courant" devient actif (fond vert)
Onglet "Puissance" devient inactif (fond blanc)
Graphique recharge avec donnÃ©es d'intensitÃ©
Axe Y change de "Puissance (W)" Ã  "IntensitÃ© (A)"
PÃ©riode et date restent inchangÃ©es
CHANGEMENT DE PÃ‰RIODE (ex: 24h â†’ 7 jours)
Graphique recharge avec nouvelle pÃ©riode
Type de graphique actuel conservÃ© (Power ou Current)
CHANGEMENT DE DATE
MÃªme comportement : recharge avec type actuel
CHANGEMENT DE DEVICE
Si nouveau device sÃ©lectionnÃ© : recharge tout, onglet Power actif
Si "Tous" ou aucun device : masquer TOUTE la section chart-section
EXPORT PNG
Exporte le graphique actuellement affichÃ© (Power ou Current)
Nom de fichier inclut le type
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
LIGNE DROITE VS COURBE
Configuration Chart.js pour lignes droites :
Dans les options du chart :
elements: {
    line: {
        tension: 0,      // Pas de lissage
        stepped: true    // Lignes en escalier
    }
}
Dans chaque dataset (optionnel, si l'option globale ne suffit pas) :
{
    // ... autres props ...
    stepped: true,
    tension: 0
}
RÃ©sultat visuel :
Mesure Ã  15:30 = 428W â†’ ligne horizontale Ã  428W
Mesure Ã  15:31 = 450W â†’ saut vertical puis ligne horizontale Ã  450W
Pas de pente progressive entre les deux points
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
TESTS Ã€ EFFECTUER
Aucun device sÃ©lectionnÃ© â†’ section graphique complÃ¨tement masquÃ©e (pas de trace)
Device "Tous" sÃ©lectionnÃ© â†’ section graphique masquÃ©e
Un device sÃ©lectionnÃ© â†’ section visible, onglet Power actif par dÃ©faut
Clic onglet Courant â†’ graphique bascule, axe Y change
Changement de pÃ©riode avec onglet Courant actif â†’ reste sur Courant
Lignes du graphique = droites (pas de courbes lissÃ©es)
Export PNG avec onglet Power â†’ nom fichier contient "power"
Export PNG avec onglet Current â†’ nom fichier contient "current"
Responsive mobile â†’ onglets restent cliquables et lisibles
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
MISE Ã€ JOUR DOCUMENTATION
Modifier dans replit.md :
Feature : Graphiques sÃ©parÃ©s Puissance/Courant avec onglets
UI : SystÃ¨me d'onglets pour basculer entre les deux vues
Chart config : Lignes droites (stepped: true) au lieu de courbes
UX : Masquage complet de la section si aucun device sÃ©lectionnÃ©
PHASE 2A : REFACTORISATION DASHBOARD.PY â†’ TEMPLATES + STATIC FILES

OBJECTIF : SÃ©parer le monolithe dashboard.py (970 lignes) en templates HTML + fichiers statiques CSS/JS pour faciliter la maintenance et futures Ã©volutions (graphiques Chart.js, dashboard client multi-tenant).

PROBLÃˆME ACTUEL :
- web/dashboard.py = 970 lignes de HTML/CSS/JS dans une seule string Python
- Impossible Ã  maintenir avec l'ajout de graphiques (200+ lignes JS supplÃ©mentaires Ã  venir)
- Pas de rÃ©utilisation possible pour futur dashboard client
- Replit AI a du mal Ã  naviguer dans ce monolithe
- Coloration syntaxique et autocomplÃ©tion impossibles

SOLUTION : Architecture templates + static files avec Jinja2 (dÃ©jÃ  inclus dans FastAPI)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

NOUVELLE STRUCTURE DE RÃ‰PERTOIRES

CrÃ©er cette arborescence :

/web/
  /templates/
    base.html              # Template de base (layout commun)
    dashboard.html         # Dashboard principal
    admin.html             # Page admin (existante Ã  migrer aussi)
    admin_pumps.html       # Page config pompes
    components/
      filters.html         # Filtres device/canal/dates
      chart.html           # Section graphique (futur)
      cycles_table.html    # Tableau des cycles
  /static/
    /css/
      main.css             # Styles globaux
      dashboard.css        # Styles spÃ©cifiques dashboard
      admin.css            # Styles admin
    /js/
      dashboard.js         # Logique dashboard
      chart-config.js      # Configuration Chart.js (futur)
      filters.js           # Gestion filtres
    /images/
      (si logos/icÃ´nes nÃ©cessaires)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Ã‰TAPE 1 : CONFIGURATION JINJA2

Modifier web/dashboard.py :

REMPLACER les imports en haut :
```python
# Ancienne version
def render_dashboard() -> str:
    return """<!DOCTYPE html>..."""

# NOUVELLE VERSION
from fastapi.templating import Jinja2Templates
from fastapi import Request
from pathlib import Path

# Initialiser Jinja2 avec le dossier templates
templates = Jinja2Templates(directory="web/templates")

def render_dashboard(request: Request, client_name: str = None, allowed_devices: list = None) -> str:
    """
    Rend le template dashboard avec contexte.
    
    Args:
        request: Request FastAPI (requis par Jinja2)
        client_name: Nom du client (pour vue multi-tenant future)
        allowed_devices: Liste devices autorisÃ©s (pour filtrage client)
    """
    context = {
        "request": request,
        "is_client_view": client_name is not None,
        "client_name": client_name,
        "allowed_devices": allowed_devices or []
    }
    return templates.TemplateResponse("dashboard.html", context)
Modifier main.py pour passer request :
ANCIEN :
@app.get("/dashboard")
async def dashboard():
    return html_response(render_dashboard())
NOUVEAU :
@app.get("/dashboard")
async def dashboard(request: Request):
    return render_dashboard(request)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Ã‰TAPE 2 : CRÃ‰ER LE TEMPLATE DE BASE
CrÃ©er web/templates/base.html :
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Dashboard{% endblock %} - FiltrePlante</title>
    
    <!-- Styles globaux -->
    <link rel="stylesheet" href="/static/css/main.css">
    
    <!-- Styles spÃ©cifiques par page -->
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Navigation (si pas vue client) -->
    {% if not is_client_view %}
    <nav class="main-nav">
        <div class="nav-container">
            <h1>ğŸŒ¿ FiltrePlante - Shelly Collector</h1>
            <div class="nav-links">
                <a href="/dashboard">ğŸ“Š Dashboard</a>
                <a href="/admin">âš™ï¸ Admin</a>
            </div>
        </div>
    </nav>
    {% else %}
    <nav class="main-nav client-view">
        <div class="nav-container">
            <h1>ğŸŒ¿ FiltrePlante - {{ client_name }}</h1>
        </div>
    </nav>
    {% endif %}
    
    <!-- Contenu principal -->
    <main>
        {% block content %}{% endblock %}
    </main>
    
    <!-- Scripts globaux -->
    <script src="/static/js/filters.js"></script>
    
    <!-- Scripts spÃ©cifiques par page -->
    {% block extra_js %}{% endblock %}
</body>
</html>
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Ã‰TAPE 3 : CRÃ‰ER LE TEMPLATE DASHBOARD
CrÃ©er web/templates/dashboard.html :
{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/dashboard.css">
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <h2>ğŸ“Š Tableau de bord</h2>
    
    <!-- Section Filtres -->
    {% include 'components/filters.html' %}
    
    <!-- Section Graphique (future) -->
    <div id="chart-section" style="display:none;">
        {% include 'components/chart.html' %}
    </div>
    
    <!-- Section Tableau des Cycles -->
    {% include 'components/cycles_table.html' %}
</div>
{% endblock %}

{% block extra_js %}
<script src="/static/js/dashboard.js"></script>
<!-- Chart.js sera ajoutÃ© ici plus tard -->
<!-- <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script> -->
<!-- <script src="/static/js/chart-config.js"></script> -->
{% endblock %}
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Ã‰TAPE 4 : CRÃ‰ER LES COMPOSANTS
4.1 CrÃ©er web/templates/components/filters.html :
Extraire la section filtres du dashboard.py actuel :
<div class="filters-section">
    <div class="filters-row">
        <div class="filter-group">
            <label for="deviceFilter">Device</label>
            <select id="deviceFilter">
                <option value="all">Tous les devices</option>
                <!-- ChargÃ© dynamiquement via JS -->
            </select>
        </div>
        
        <div class="filter-group">
            <label for="channelFilter">Canal</label>
            <select id="channelFilter">
                <option value="all">Tous les canaux</option>
                <!-- ChargÃ© dynamiquement via JS -->
            </select>
        </div>
        
        <div class="filter-group">
            <label for="startDate">Date dÃ©but</label>
            <input type="date" id="startDate">
        </div>
        
        <div class="filter-group">
            <label for="endDate">Date fin</label>
            <input type="date" id="endDate">
        </div>
        
        <button id="refreshButton" class="btn-primary">RafraÃ®chir</button>
    </div>
    
    {% if is_client_view %}
    <p class="info-message">
        â„¹ï¸ Affichage limitÃ© aux devices autorisÃ©s
    </p>
    {% endif %}
</div>
4.2 CrÃ©er web/templates/components/chart.html (prÃ©paration future) :
<div class="chart-wrapper">
    <div class="chart-header">
        <h3>ğŸ“Š ActivitÃ© Ã©lectrique</h3>
        <p class="date-range"></p>
    </div>
    
    <div class="chart-controls">
        <div class="date-selector">
            <label for="chartEndDate">Jusqu'au :</label>
            <input type="date" id="chartEndDate" />
            <button id="resetDateBtn" class="btn-reset" title="Revenir Ã  aujourd'hui">â†»</button>
        </div>
        
        <div class="period-selector">
            <button class="period-btn active" data-period="24h">24h</button>
            <button class="period-btn" data-period="7d">7 jours</button>
            <button class="period-btn" data-period="30d">30 jours</button>
        </div>
        
        <button id="exportChartBtn" class="btn-export">ğŸ“¥ PNG</button>
    </div>
    
    <div class="chart-tabs">
        <button class="chart-tab active" data-type="power">âš¡ Consommation Ã©lectrique (W)</button>
        <button class="chart-tab" data-type="current">ğŸ”Œ Courant (A)</button>
    </div>
    
    <div class="chart-container">
        <canvas id="powerChart"></canvas>
    </div>
</div>
4.3 CrÃ©er web/templates/components/cycles_table.html :
<div class="cycles-section">
    <h3>ğŸ”„ Cycles de pompage</h3>
    
    <div class="info-banner">
        ğŸ‘‰ Faites dÃ©filer pour voir toutes les colonnes
    </div>
    
    <div class="table-container">
        <table id="cyclesTable">
            <thead>
                <tr>
                    <th>Device</th>
                    <th>Canal</th>
                    <th>Date</th>
                    <th>DÃ©marrage</th>
                    <th>ArrÃªt</th>
                    <th>DurÃ©e</th>
                    <th>Puissance moy.</th>
                    <th>Volume pompÃ© (mÂ³)</th>
                    <th>CO2e (kg)</th>
                </tr>
            </thead>
            <tbody>
                <!-- Rempli dynamiquement via JS -->
            </tbody>
        </table>
    </div>
    
    <div id="no-data-message" style="display:none;">
        <p>Aucun cycle dÃ©tectÃ© pour cette pÃ©riode.</p>
    </div>
</div>
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Ã‰TAPE 5 : EXTRAIRE LES STYLES CSS
5.1 CrÃ©er web/static/css/main.css (styles globaux) :
Extraire les styles communs du dashboard.py actuel (reset, body, navigation, etc.).
/* Reset et base */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: #f5f7fa;
    color: #333;
    line-height: 1.6;
}

/* Navigation */
.main-nav {
    background: #2d5a3d;
    color: white;
    padding: 1rem 0;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.nav-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.nav-container h1 {
    font-size: 1.5rem;
    font-weight: 600;
}

.nav-links {
    display: flex;
    gap: 1.5rem;
}

.nav-links a {
    color: white;
    text-decoration: none;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    transition: background 0.3s;
}

.nav-links a:hover {
    background: rgba(255,255,255,0.1);
}

/* Vue client (pas de liens admin) */
.main-nav.client-view .nav-container {
    justify-content: center;
}

/* Conteneur principal */
main {
    max-width: 1400px;
    margin: 2rem auto;
    padding: 0 2rem;
}

/* Boutons globaux */
.btn-primary {
    padding: 0.6rem 1.5rem;
    background: #2d5a3d;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 500;
    transition: background 0.3s;
}

.btn-primary:hover {
    background: #1a5738;
}

.btn-reset {
    padding: 0.4rem 0.8rem;
    background: white;
    border: 1px solid #ced4da;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s;
}

.btn-reset:hover {
    background: #e9ecef;
}

/* Messages info */
.info-message, .info-banner {
    background: #e7f3ff;
    border: 1px solid #b3d9ff;
    border-radius: 6px;
    padding: 0.8rem;
    margin: 1rem 0;
    color: #004085;
}

/* Responsive */
@media (max-width: 768px) {
    .nav-container {
        flex-direction: column;
        gap: 1rem;
    }
    
    main {
        padding: 0 1rem;
    }
}
5.2 CrÃ©er web/static/css/dashboard.css (spÃ©cifique dashboard) :
Extraire tous les styles spÃ©cifiques au dashboard (filtres, tableau, graphiques).
/* Section Dashboard */
.dashboard-container {
    background: white;
    border-radius: 12px;
    padding: 2rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.dashboard-container h2 {
    color: #2d5a3d;
    margin-bottom: 2rem;
}

/* Filtres */
.filters-section {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 1.5rem;
    margin-bottom: 2rem;
}

.filters-row {
    display: flex;
    gap: 1rem;
    align-items: flex-end;
    flex-wrap: wrap;
}

.filter-group {
    flex: 1;
    min-width: 150px;
}

.filter-group label {
    display: block;
    font-weight: 500;
    margin-bottom: 0.5rem;
    color: #495057;
}

.filter-group select,
.filter-group input[type="date"] {
    width: 100%;
    padding: 0.5rem;
    border: 1px solid #ced4da;
    border-radius: 6px;
    font-size: 1rem;
}

/* Tableau cycles */
.cycles-section {
    margin-top: 2rem;
}

.cycles-section h3 {
    color: #2d5a3d;
    margin-bottom: 1rem;
}

.table-container {
    overflow-x: auto;
    border-radius: 8px;
    border: 1px solid #dee2e6;
}

#cyclesTable {
    width: 100%;
    border-collapse: collapse;
    background: white;
}

#cyclesTable thead {
    background: #2d5a3d;
    color: white;
}

#cyclesTable th,
#cyclesTable td {
    padding: 0.8rem;
    text-align: left;
    border-bottom: 1px solid #dee2e6;
}

#cyclesTable tbody tr:hover {
    background: #f8f9fa;
}

#cyclesTable tbody tr:last-child td {
    border-bottom: none;
}

#no-data-message {
    text-align: center;
    padding: 3rem;
    color: #6c757d;
}

/* Section graphique (pour futur Chart.js) */
#chart-section {
    background: white;
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.chart-wrapper {
    /* Styles graphiques Ã  venir */
}

/* Responsive */
@media (max-width: 768px) {
    .filters-row {
        flex-direction: column;
    }
    
    .filter-group {
        width: 100%;
    }
}
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Ã‰TAPE 6 : EXTRAIRE LA LOGIQUE JAVASCRIPT
6.1 CrÃ©er web/static/js/filters.js :
Extraire toute la logique de gestion des filtres et chargement devices.
// Gestion des filtres dashboard

let currentDeviceFilter = 'all';
let currentChannelFilter = 'all';

document.addEventListener('DOMContentLoaded', function() {
    initFilters();
});

async function initFilters() {
    // Charger la liste des devices
    await loadDevices();
    
    // Initialiser les dates par dÃ©faut
    const today = new Date().toISOString().split('T')[0];
    const oneMonthAgo = new Date();
    oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
    const startDate = oneMonthAgo.toISOString().split('T')[0];
    
    document.getElementById('startDate').value = startDate;
    document.getElementById('endDate').value = today;
    
    // Event listeners
    document.getElementById('deviceFilter').addEventListener('change', handleDeviceChange);
    document.getElementById('channelFilter').addEventListener('change', handleChannelChange);
    document.getElementById('refreshButton').addEventListener('click', handleRefresh);
}

async function loadDevices() {
    try {
        const response = await fetch('/api/config/devices');
        const data = await response.json();
        
        const deviceSelect = document.getElementById('deviceFilter');
        deviceSelect.innerHTML = '<option value="all">Tous les devices</option>';
        
        data.devices.forEach(device => {
            const option = document.createElement('option');
            option.value = device.device_id;
            option.textContent = device.device_name || device.device_id;
            deviceSelect.appendChild(option);
        });
        
    } catch (error) {
        console.error('Erreur chargement devices:', error);
    }
}

function handleDeviceChange() {
    currentDeviceFilter = this.value;
    // Recharger canaux si device spÃ©cifique sÃ©lectionnÃ©
    loadChannels(currentDeviceFilter);
    // Notifier le dashboard
    if (typeof onFiltersChanged === 'function') {
        onFiltersChanged();
    }
}

function handleChannelChange() {
    currentChannelFilter = this.value;
    if (typeof onFiltersChanged === 'function') {
        onFiltersChanged();
    }
}

function handleRefresh() {
    if (typeof onFiltersChanged === 'function') {
        onFiltersChanged();
    }
}

async function loadChannels(deviceId) {
    const channelSelect = document.getElementById('channelFilter');
    channelSelect.innerHTML = '<option value="all">Tous les canaux</option>';
    
    if (deviceId === 'all') return;
    
    try {
        const response = await fetch(`/api/config/channels?device_id=${deviceId}`);
        const data = await response.json();
        
        data.channels.forEach(channel => {
            const option = document.createElement('option');
            option.value = channel.channel;
            option.textContent = channel.channel_name || channel.channel;
            channelSelect.appendChild(option);
        });
    } catch (error) {
        console.error('Erreur chargement canaux:', error);
    }
}

// Exports pour utilisation externe
function getFilters() {
    return {
        device: currentDeviceFilter,
        channel: currentChannelFilter,
        startDate: document.getElementById('startDate').value,
        endDate: document.getElementById('endDate').value
    };
}
6.2 CrÃ©er web/static/js/dashboard.js :
Logique principale du dashboard (chargement cycles, etc.).
// Dashboard principal

document.addEventListener('DOMContentLoaded', function() {
    // Charger les donnÃ©es initiales
    loadCycles();
});

// Callback appelÃ© quand filtres changent
function onFiltersChanged() {
    loadCycles();
}

async function loadCycles() {
    const filters = getFilters();
    
    // Construire URL API
    let url = '/api/pump-cycles?';
    const params = new URLSearchParams();
    
    if (filters.device !== 'all') {
        params.append('devices', filters.device);
    }
    if (filters.channel !== 'all') {
        params.append('channels', filters.channel);
    }
    if (filters.startDate) {
        params.append('start_date', filters.startDate);
    }
    if (filters.endDate) {
        params.append('end_date', filters.endDate);
    }
    
    url += params.toString();
    
    try {
        const response = await fetch(url);
        const data = await response.json();
        
        displayCycles(data.cycles);
    } catch (error) {
        console.error('Erreur chargement cycles:', error);
        showError('Erreur de chargement des donnÃ©es');
    }
}

function displayCycles(cycles) {
    const tbody = document.querySelector('#cyclesTable tbody');
    const noDataMsg = document.getElementById('no-data-message');
    
    tbody.innerHTML = '';
    
    if (!cycles || cycles.length === 0) {
        noDataMsg.style.display = 'block';
        return;
    }
    
    noDataMsg.style.display = 'none';
    
    cycles.forEach(cycle => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${cycle.device_name || cycle.device_id}</td>
            <td>${cycle.channel_name || cycle.channel}</td>
            <td>${formatDate(cycle.start_time)}</td>
            <td>${formatTime(cycle.start_time)}</td>
            <td>${formatTime(cycle.end_time)}</td>
            <td>${cycle.duration_minutes} min</td>
            <td>${cycle.avg_power_w.toFixed(0)} W</td>
            <td>${cycle.volume_m3.toFixed(2)} mÂ³</td>
            <td>${cycle.co2e_kg.toFixed(3)} kg</td>
        `;
        tbody.appendChild(row);
    });
}

function formatDate(isoString) {
    const date = new Date(isoString);
    return date.toLocaleDateString('fr-FR');
}

function formatTime(isoString) {
    const date = new Date(isoString);
    return date.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
}

function showError(message) {
    // TODO: ImplÃ©menter affichage d'erreur Ã©lÃ©gant
    alert(message);
}
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Ã‰TAPE 7 : CONFIGURER FASTAPI POUR SERVIR LES STATIC FILES
Dans main.py, ajouter aprÃ¨s la crÃ©ation de l'app :
from fastapi.staticfiles import StaticFiles

app = FastAPI()

# Monter le dossier static
app.mount("/static", StaticFiles(directory="web/static"), name="static")

# ... reste du code ...
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Ã‰TAPE 8 : MIGRATION PROGRESSIVE (IMPORTANT)
8.1 GARDER L'ANCIEN CODE TEMPORAIREMENT
Dans web/dashboard.py, ajouter une fonction de fallback :
def render_dashboard_legacy() -> str:
    """Ancienne version monolithe (backup)"""
    return """<!DOCTYPE html>..."""  # Code actuel

def render_dashboard(request: Request, client_name: str = None, allowed_devices: list = None):
    """Nouvelle version avec templates"""
    try:
        # Essayer nouvelle version
        context = {
            "request": request,
            "is_client_view": client_name is not None,
            "client_name": client_name,
            "allowed_devices": allowed_devices or []
        }
        return templates.TemplateResponse("dashboard.html", context)
    except Exception as e:
        print(f"âš ï¸ Erreur template, fallback legacy: {e}", flush=True)
        # Fallback vers ancienne version
        return render_dashboard_legacy()
8.2 TESTER PROGRESSIVEMENT
Phase de test :
CrÃ©er tous les fichiers templates/static
Tester /dashboard avec nouvelle version
Si problÃ¨me â†’ le fallback marche
Une fois validÃ© â†’ supprimer render_dashboard_legacy()
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Ã‰TAPE 9 : MÃŠME CHOSE POUR ADMIN (OPTIONNEL MAIS RECOMMANDÃ‰)
RÃ©pÃ©ter la structure pour web/admin.py :
CrÃ©er templates/admin.html
CrÃ©er templates/admin_pumps.html
CrÃ©er static/css/admin.css
Extraire JS dans static/js/admin.js
Structure identique, mÃªmes principes.
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
TESTS Ã€ EFFECTUER
DASHBOARD LOADING :
AccÃ¨s /dashboard â†’ affiche correctement
CSS chargÃ© (styles visibles)
JS chargÃ© (filtres fonctionnels)
FILTRES :
SÃ©lection device â†’ charge canaux
SÃ©lection dates â†’ met Ã  jour donnÃ©es
Clic rafraÃ®chir â†’ recharge tableau
TABLEAU CYCLES :
DonnÃ©es affichÃ©es correctement
Formatage dates/heures OK
Responsive mobile
VUE CLIENT (PRÃ‰PARATION MULTI-TENANT) :
is_client_view=True â†’ pas de liens admin visibles
client_name affichÃ© dans header
FALLBACK :
Si erreur template â†’ fallback legacy fonctionne
PERFORMANCE :
Chargement < 500ms
Pas de FOUC (flash of unstyled content)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
AVANTAGES POST-REFACTORISATION
âœ… Code maintenable (HTML/CSS/JS sÃ©parÃ©s)
âœ… RÃ©utilisation (base.html pour toutes les pages)
âœ… PrÃªt pour graphiques Chart.js (chart-config.js dÃ©diÃ©)
âœ… PrÃ©parÃ© pour multi-tenant (is_client_view)
âœ… Meilleure DX pour Replit AI (navigation fichiers)
âœ… Coloration syntaxe + autocomplÃ©tion
âœ… Hot reload fonctionnel (modif CSS/JS sans restart)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ORDRE D'IMPLÃ‰MENTATION RECOMMANDÃ‰
CrÃ©er structure rÃ©pertoires (templates/, static/)
Configurer FastAPI (StaticFiles + Jinja2Templates)
CrÃ©er base.html
CrÃ©er dashboard.html + components
Extraire CSS dans main.css + dashboard.css
Extraire JS dans filters.js + dashboard.js
Modifier render_dashboard() avec fallback
Tester /dashboard
Valider â†’ supprimer legacy code
RÃ©pÃ©ter pour admin.html (optionnel)
Mettre Ã  jour replit.md
AJUSTEMENT : SÃ©lecteur de date de fin de pÃ©riode pour analyse historique

OBJECTIF : Permettre d'analyser l'activitÃ© des pompes sur n'importe quelle pÃ©riode passÃ©e, pas seulement les "derniers X jours jusqu'Ã  maintenant".

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

FONCTIONNALITÃ‰

Ajouter un sÃ©lecteur de date "Jusqu'au" qui dÃ©finit la fin de la pÃ©riode Ã  afficher.

EXEMPLES D'USAGE :
- PÃ©riode "7 jours" + date de fin "12/12/2025" â†’ affiche du 05/12/2025 au 12/12/2025
- PÃ©riode "24h" + date de fin "01/02/2026" â†’ affiche du 31/01/2026 23:00 au 01/02/2026 23:00
- Par dÃ©faut : date de fin = aujourd'hui (comportement actuel conservÃ©)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

INTERFACE UTILISATEUR

1. AJOUTER un date picker dans la section des contrÃ´les du graphique
   - Label : "Jusqu'au :"
   - Input type="date" 
   - Valeur par dÃ©faut : date du jour
   - Bouton "â†»" pour rÃ©initialiser Ã  aujourd'hui

2. ORGANISATION des contrÃ´les :
   - Date picker Ã  gauche
   - Boutons pÃ©riode (24h/7j/30j) au milieu
   - Bouton export PNG Ã  droite

3. TITRE DU GRAPHIQUE dynamique :
   - Afficher la plage exacte : "ğŸ’§ ActivitÃ© de la pompe (05/12/2025 - 12/12/2025)"
   - Se met Ã  jour automatiquement selon date + pÃ©riode sÃ©lectionnÃ©es

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

LOGIQUE BACKEND

1. MODIFIER l'endpoint /api/power-chart-data :
   - Ajouter paramÃ¨tre optionnel : end_date (format YYYY-MM-DD)
   - Si end_date fourni : utiliser cette date comme fin de pÃ©riode (Ã  23:59:59)
   - Si end_date absent : utiliser maintenant (comportement actuel)
   - Calculer start_date = end_date - pÃ©riode (24h/7d/30d)

2. REQUÃŠTE SQL modifiÃ©e :
   - Filtrer : timestamp >= start_date AND timestamp <= end_date
   - Reste identique (agrÃ©gation, grouping, etc.)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

LOGIQUE FRONTEND

1. INITIALISATION :
   - Au chargement de la page : prÃ©-remplir le date picker avec la date du jour
   - Afficher le graphique avec les donnÃ©es par dÃ©faut (jusqu'Ã  aujourd'hui)

2. Ã‰VÃ‰NEMENTS :
   - Changement de date â†’ recharger les donnÃ©es du graphique avec la nouvelle end_date
   - Clic sur bouton reset â†’ remettre date = aujourd'hui et recharger
   - Changement de pÃ©riode (24h/7j/30j) â†’ recharger avec la date actuellement sÃ©lectionnÃ©e

3. APPEL API :
   - Inclure le paramÃ¨tre end_date dans l'URL si une date est sÃ©lectionnÃ©e
   - Format : /api/power-chart-data?device_id=X&period=7d&end_date=2025-12-12

4. MISE Ã€ JOUR DU TITRE :
   - Calculer start_date = end_date - pÃ©riode
   - Formater en franÃ§ais : "05/12/2025 - 12/12/2025"
   - Mettre Ã  jour aprÃ¨s chaque chargement de donnÃ©es

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

VALIDATIONS

1. CÃ”TÃ‰ FRONTEND :
   - Bloquer sÃ©lection de date future (date > aujourd'hui)
   - Si date future dÃ©tectÃ©e : alert + reset Ã  aujourd'hui
   - Date maximale du date picker = aujourd'hui

2. CÃ”TÃ‰ BACKEND :
   - Valider format de end_date (YYYY-MM-DD)
   - Retourner erreur 400 si format invalide
   - Si aucune donnÃ©e dans la pÃ©riode : retourner tableau vide (pas d'erreur)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

COMPORTEMENTS ATTENDUS

1. PAR DÃ‰FAUT (premiÃ¨re visite) :
   - Date picker = aujourd'hui
   - PÃ©riode = 24h (dÃ©jÃ  actif)
   - Graphique = derniÃ¨res 24h jusqu'Ã  maintenant

2. SÃ‰LECTION DATE PASSÃ‰E :
   - User clique sur date picker et choisit "10/02/2026"
   - User a "7 jours" sÃ©lectionnÃ©
   - Graphique affiche : 03/02/2026 - 10/02/2026
   - Titre mis Ã  jour avec ces dates

3. CHANGEMENT DE PÃ‰RIODE :
   - Date = "10/02/2026", pÃ©riode = "7 jours"
   - User clique sur "30 jours"
   - Graphique affiche : 11/01/2026 - 10/02/2026
   - Titre mis Ã  jour

4. BOUTON RESET :
   - User a explorÃ© l'historique (date = "15/01/2026")
   - User clique sur "â†»"
   - Date picker revient Ã  aujourd'hui
   - Graphique recharge avec donnÃ©es actuelles

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

STYLE VISUEL

- Date picker : style cohÃ©rent avec les boutons de pÃ©riode
- Fond gris clair (#f8f9fa) autour du date picker
- Bordure verte (#2d5a3d) au focus
- Bouton reset : simple, icÃ´ne â†», hover = fond gris
- Responsive : sur mobile, date picker prend toute la largeur au-dessus des boutons

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TESTS Ã€ EFFECTUER

1. Date par dÃ©faut = aujourd'hui â†’ graphique fonctionne
2. SÃ©lection date passÃ©e (ex: 01/01/2026) â†’ affiche historique correct
3. Changement pÃ©riode avec date passÃ©e â†’ recalcule correctement start_date
4. Bouton reset â†’ revient Ã  aujourd'hui et recharge
5. Tentative date future â†’ bloquÃ©e avec message d'erreur
6. Titre graphique â†’ affiche la bonne plage de dates en franÃ§ais
7. Responsive mobile â†’ date picker reste utilisable

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

MISE Ã€ JOUR DOCUMENTATION

Ajouter dans replit.md :
- Feature : SÃ©lecteur de date de fin pour analyse historique
- API : ParamÃ¨tre end_date optionnel dans /api/power-chart-data
- UX : Bouton reset pour revenir Ã  la vue actuelle
- Validation : Blocage des dates futures
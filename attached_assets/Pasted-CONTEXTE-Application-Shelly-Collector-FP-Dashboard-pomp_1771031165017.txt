CONTEXTE
========
Application Shelly_Collector_FP - Dashboard pompes.
Le cycle detector calcule dÃ©jÃ  avg_current_a.
L'API retourne dÃ©jÃ  cette donnÃ©e dans les cycles.
Besoin : Afficher cette colonne dans le tableau du dashboard.

OBJECTIF
========
Ajouter une colonne "Courant moy." entre "Puissance moy." et la fin du tableau.

SPÃ‰CIFICATIONS
===============

MODIFICATION DANS web/dashboard.py
-----------------------------------

1. AJOUTER L'EN-TÃŠTE DE COLONNE

Dans le <thead> du tableau, APRÃˆS la colonne "Puissance moy." :

<th onclick="sortTable('avg_current_a')">Courant moy. <span class="sort-icon">â†•</span></th>

Le <thead> complet devrait ressembler Ã  :

<thead>
    <tr>
        <th onclick="sortTable('device_id')">Device <span class="sort-icon">â†•</span></th>
        <th onclick="sortTable('channel')">Canal <span class="sort-icon">â†•</span></th>
        <th onclick="sortTable('start_date')">Date <span class="sort-icon">â†•</span></th>
        <th onclick="sortTable('start_time')">Heure dÃ©but <span class="sort-icon">â†•</span></th>
        <th onclick="sortTable('end_time')">Heure fin <span class="sort-icon">â†•</span></th>
        <th onclick="sortTable('duration_minutes')">DurÃ©e <span class="sort-icon">â†•</span></th>
        <th onclick="sortTable('avg_power_w')">Puissance moy. <span class="sort-icon">â†•</span></th>
        <th onclick="sortTable('avg_current_a')">Courant moy. <span class="sort-icon">â†•</span></th>
    </tr>
</thead>


2. AJOUTER LA CELLULE DE DONNÃ‰ES

Dans la fonction renderTable() du JavaScript, APRÃˆS la ligne qui ajoute avg_power_w :

// AprÃ¨s la ligne :
// <td>${cycle.avg_power_w ? cycle.avg_power_w.toFixed(1) + ' W' : '-'}</td>

// Ajouter :
<td>${cycle.avg_current_a ? cycle.avg_current_a.toFixed(1) + ' A' : '-'}</td>

Exemple de ligne complÃ¨te dans renderTable() :

row.innerHTML = `
    <td>${deviceName}</td>
    <td>${channelName}</td>
    <td>${cycle.start_date}</td>
    <td>${cycle.start_time}</td>
    <td>${cycle.end_time || 'En cours'}</td>
    <td>${cycle.duration_minutes ? cycle.duration_minutes + ' min' : '-'}</td>
    <td>${cycle.avg_power_w ? cycle.avg_power_w.toFixed(1) + ' W' : '-'}</td>
    <td>${cycle.avg_current_a ? cycle.avg_current_a.toFixed(1) + ' A' : '-'}</td>
`;


3. METTRE Ã€ JOUR LE TRI

Dans la fonction updateSortIcons() du JavaScript, ajouter 'avg_current_a' dans la liste des colonnes :

const columns = [
    'device_id', 
    'channel', 
    'start_date', 
    'start_time', 
    'end_time', 
    'duration_minutes', 
    'avg_power_w',
    'avg_current_a'  // ðŸ†• Ajouter cette ligne
];


4. METTRE Ã€ JOUR L'EXPORT CSV (si existant)

Si la fonction exportCSV() existe, ajouter le champ current dans les headers et les donnÃ©es :

const headers = [
    'Device', 
    'Canal', 
    'Date', 
    'Heure dÃ©but', 
    'Heure fin', 
    'DurÃ©e (min)', 
    'Puissance moy. (W)',
    'Courant moy. (A)'  // ðŸ†•
];

Et dans la boucle des cycles :

csv += `${deviceName},${channelName},${cycle.start_date},${cycle.start_time},${cycle.end_time || 'En cours'},${cycle.duration_minutes || ''},${cycle.avg_power_w || ''},${cycle.avg_current_a || ''}\n`;


TESTS
=====
1. âœ… Recharger /dashboard
2. âœ… VÃ©rifier que la colonne "Courant moy." apparaÃ®t aprÃ¨s "Puissance moy."
3. âœ… VÃ©rifier que les valeurs s'affichent (ex: "2.5 A")
4. âœ… Cliquer sur "Courant moy." â†’ Tri dÃ©croissant
5. âœ… Recliquer â†’ Tri croissant
6. âœ… Recliquer â†’ Retour Ã  l'ordre normal
7. âœ… VÃ©rifier que l'export CSV inclut la colonne

RÃ‰SULTAT ATTENDU
================
Tableau avec 8 colonnes :
1. Device
2. Canal
3. Date
4. Heure dÃ©but
5. Heure fin
6. DurÃ©e
7. Puissance moy.
8. ðŸ†• Courant moy. (triable)

Exemple de ligne :
Sagemcom | PR2 | 13/02/2026 | 23h57 | 23h59 | 2 min | 1142.3 W | 5.4 A